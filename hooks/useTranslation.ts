import React, { createContext, useContext, useState, useEffect, useMemo, useCallback } from 'react';

type Language = 'en' | 'es' | 'pt' | 'it' | 'de';
type Translations = Record<string, string>;

const translations: Record<Language, Translations> = {
  en: {
    "sidebar.title": "AGUAI",
    "sidebar.subtitle": "Manage your contacts efficiently.",
    "sidebar.addContact": "Add Contact",
    "sidebar.addMultiple": "Multi",
    "sidebar.fromExcel": "From Excel",
    "sidebar.fromDrive": "From Drive",
    "sidebar.searchPlaceholder": "Search by name or phone...",
    "clientDetail.noClientSelected": "No Client Selected",
    "clientDetail.selectOrAdd": "Select a client from the list or add a new one.",
    "clientDetail.sendMessage": "Send Message",
    "clientDetail.notOnWhatsApp": "Not on WhatsApp",
    "clientDetail.checkingWhatsApp": "Checking WhatsApp...",
    "clientDetail.followUpTitle": "Follow-up",
    "clientDetail.ratingTitle": "Client Rating",
    "clientDetail.notesTitle": "Notes",
    "clientDetail.quotesTitle": "Old Budgets / Quotes",
    "clientDetail.invoicesTitle": "Invoices",
    "clientDetail.budgetsTitle": "Budgets",
    "followUp.nextFollowUp": "Time until next follow-up:",
    "followUp.noFollowUp": "No follow-up scheduled.",
    "followUp.due": "Follow-up due!",
    "followUp.registerCall": "Register Call",
    "followUp.postpone": "Postpone",
    "followUp.reschedule": "Reschedule",
    "followUp.pause": "Pause",
    "followUp.resume": "Resume",
    "followUp.delete": "Delete",
    "notes.placeholder": "Write observations or details for future calls...",
    "notes.lastSaved": "Last saved: {date}",
    "fileUpload.uploadNew": "Upload New File",
    "fileUpload.descriptionPlaceholder": "Optional description...",
    "fileUpload.selectFile": "Select a file",
    "fileUpload.fileTypes": "PDF, PNG, JPG, etc.",
    "fileUpload.analyzeWithGemini": "Analyze with Gemini",
    "fileUpload.deleteFile": "Delete file",
    "chatbot.header": "AGUAI Assistant",
    "chatbot.inputPlaceholder": "Ask or speak...",
    "chatbot.locationError": "I couldn't get your location to answer that. Please ensure you've enabled location services.",
    "chatbot.sources": "Sources:",
    "chatbot.speak": "Enable Speech",
    "chatbot.stopSpeaking": "Disable Speech",
    "chatbot.listening": "Listening...",
    "chatbot.fileAnalysisError": "Sorry, I couldn't process that file.",
    "chatbot.contactAdded": "OK, I've added {name} to your contacts.",
    "clientForm.addTitle": "Add New Client",
    "clientForm.editTitle": "Edit Client",
    "clientForm.companyName": "Company Name",
    "clientForm.phoneNumber": "Phone Number",
    "clientForm.industry": "Industry / Activity",
    "clientForm.cancel": "Cancel",
    "clientForm.save": "Save",
    "multiClientForm.title": "Add Multiple Clients",
    "multiClientForm.pasteLabel": "Paste a list of clients below. Each client should be on a new line. You can use commas or tabs to separate Company Name, Phone Number, and Industry.",
    "multiClientForm.pastePlaceholder": "Example:\nInnovate Inc, 555-123-4567, Technology\nBuildCo, 555-987-6543, Construction\nJust a number: 555-222-3333",
    "multiClientForm.preview": "Preview",
    "multiClientForm.newClients": "New Clients ({count})",
    "multiClientForm.noNewClients": "No new clients to add.",
    "multiClientForm.duplicates": "Duplicate Phone Numbers ({count})",
    "multiClientForm.duplicatesQuestion": "These clients already exist. What would you like to do?",
    "multiClientForm.skip": "Skip",
    "multiClientForm.overwrite": "Overwrite",
    "multiClientForm.noDuplicates": "No duplicates found.",
    "multiClientForm.back": "Back",
    "multiClientForm.confirmAndSave": "Confirm and Save",
    "alerts.confirmDelete": "Are you sure you want to delete this client?",
    "alerts.confirmFollowUpDelete": "Are you sure you want to delete this follow-up? This action cannot be undone.",
    "alerts.importSuccess": "Import complete! {added} clients added, {updated} clients updated.",
    "alerts.noClientsParsed": "No valid client data could be parsed. Please check your text and try again.",
    "alerts.geminiAnalysisPrefix": "[Gemini Analysis]:",
    "alerts.imageAnalysisFailed": "Failed to analyze image.",
    "alerts.onlyImagesAnalyzed": "Only image files can be analyzed.",
    "alerts.fileUploadFailed": "Failed to upload file.",
    "alerts.unsupportedFileType": "Unsupported file type. Please upload .xlsx, .xls, .csv, or .txt files.",
    "alerts.fileReadFailed": "Failed to read the file.",
    "alerts.noClientsInFile": "No valid clients found in the file.",
    "alerts.fileParseError": "There was an error parsing the file. Please check the file format and try again.",
    "settings.title": "Settings",
    "settings.appearance": "Appearance",
    "settings.light": "Light",
    "settings.dark": "Dark",
    "settings.system": "System",
    "settings.language": "Language",
    "settings.branding": "Branding",
    "settings.logo": "Company Logo",
    "settings.logoHelp": "Upload a logo to include in generated PDFs.",
    "postponeModal.title": "Postpone Follow-up",
    "rescheduleModal.title": "Reschedule Follow-up",
    "postponeModal.newDateTime": "New date and time",
    "postponeModal.reset": "Reset to Default (7 days)",
    "notifications.followUp.title": "Follow-up Reminder",
    "notifications.followUp.body": "Time for follow-up with {clientName}!",
    "countdown.paused": "Pausado",
    "suspended.title": "Suspended",
    "agenda.title": "Agenda",
    "addContact.manual": "Manual",
    "addContact.camera": "Scan Card",
    "addContact.qr": "Scan QR",
    "budgets.title": "Budgets",
    "budgets.lists": "Lists",
    "budgets.new": "New Budget",
    "budgets.noClientSelected": "Select a client to start.",
    "budgets.selectClient": "Select a client...",
    "budgets.selectPriceList": "Select a price list",
    "budgets.addProduct": "Add Product",
    "budgets.finish": "Finish Budget",
    "budgets.searchProduct": "Search product by name or code...",
    "budgets.noProductsFound": "No products found in this list.",
    "budgets.table.product": "Product",
    "budgets.table.price": "Price",
    "budgets.table.quantity": "Qty",
    "budgets.table.total": "Total",
    "budgets.subtotal": "Subtotal",
    "budgets.discount": "Discount",
    "budgets.total": "Total",
    "budgets.enterDiscount": "Enter discount (%)",
    "budgets.confirm": "Confirm",
    "budgets.saved": "Budget saved successfully!",
    "budgets.preview": "Preview PDF",
    "budgets.share": "Share",
    "budgets.view": "View",
    "budgets.delete": "Delete",
    "budgets.noBudgets": "No budgets created for this client yet.",
    "budgets.searchOrAddClient": "Search client or type to add...",
    "budgets.addNewClient": "+ Add new client: \"{name}\"",
    "budgets.noClientFound": "No client found.",
    "budgets.alert.selectClientAndProducts": "Please select or create a client and add at least one product.",
    "budgets.addClientModal.title": "Add New Client",
    "budgets.addClientModal.phoneRequired": "A phone number is required to quickly add a client.",
    "alerts.confirmBudgetDelete": "Are you sure you want to delete this budget?",
    "priceList.distributor": "Distributor",
    "priceList.consumer": "Final Consumer",
    "priceList.company": "Company",
    "priceList.cost": "Cost",
    "priceList.upload": "Upload or drop a file",
    "priceList.uploadFrom": "Upload from",
    "priceList.device": "Device",
    "priceList.drive": "Drive",
    "priceList.uploadedOn": "Uploaded on",
    "priceList.view": "View",
    "priceList.replace": "Replace",
    "priceList.delete": "Delete",
    "priceList.noList": "No list uploaded.",
    "priceList.processing": "Processing file...",
    "priceList.parseError": "Could not process the list. Check format.",
    "contextMenu.call": "Call {phone}",
    "contextMenu.whatsapp": "Send WhatsApp",
    "contextMenu.whatsappCall": "WhatsApp Call",
    "contextMenu.generateBudget": "Generate Budget",
    "clientTypes.title": "Client Type",
    "clientTypes.none": "Type"
  },
  es: {
    "sidebar.title": "AGUAI",
    "sidebar.subtitle": "Gestiona tus contactos eficientemente.",
    "sidebar.addContact": "Añadir Contacto",
    "sidebar.addMultiple": "Multi",
    "sidebar.fromExcel": "Desde Excel",
    "sidebar.fromDrive": "Desde Drive",
    "sidebar.searchPlaceholder": "Buscar por nombre o teléfono...",
    "clientDetail.noClientSelected": "Ningún Cliente Seleccionado",
    "clientDetail.selectOrAdd": "Selecciona un cliente de la lista o añade uno nuevo.",
    "clientDetail.sendMessage": "Enviar Mensaje",
    "clientDetail.notOnWhatsApp": "No está en WhatsApp",
    "clientDetail.checkingWhatsApp": "Verificando WhatsApp...",
    "clientDetail.followUpTitle": "Seguimiento",
    "clientDetail.ratingTitle": "Valoración del Cliente",
    "clientDetail.notesTitle": "Notas",
    "clientDetail.quotesTitle": "Presupuestos Antiguos",
    "clientDetail.invoicesTitle": "Facturas",
    "clientDetail.budgetsTitle": "Presupuestos",
    "followUp.nextFollowUp": "Tiempo hasta el próximo seguimiento:",
    "followUp.noFollowUp": "No hay seguimiento programado.",
    "followUp.due": "¡Seguimiento requerido!",
    "followUp.registerCall": "Registrar Llamada",
    "followUp.postpone": "Pospener",
    "followUp.reschedule": "Reprogramar",
    "followUp.pause": "Pausar",
    "followUp.resume": "Reanudar",
    "followUp.delete": "Eliminar",
    "notes.placeholder": "Escribe observaciones o detalles para futuras llamadas...",
    "notes.lastSaved": "Último guardado: {date}",
    "fileUpload.uploadNew": "Subir Nuevo Archivo",
    "fileUpload.descriptionPlaceholder": "Descripción opcional...",
    "fileUpload.selectFile": "Selecciona un archivo",
    "fileUpload.fileTypes": "PDF, PNG, JPG, etc.",
    "fileUpload.analyzeWithGemini": "Analizar con Gemini",
    "fileUpload.deleteFile": "Eliminar archivo",
    "chatbot.header": "Asistente AGUAI",
    "chatbot.inputPlaceholder": "Pregunta o habla...",
    "chatbot.locationError": "No pude obtener tu ubicación para responder. Asegúrate de haber habilitado los servicios de ubicación.",
    "chatbot.sources": "Fuentes:",
    "chatbot.speak": "Activar Voz",
    "chatbot.stopSpeaking": "Desactivar Voz",
    "chatbot.listening": "Escuchando...",
    "chatbot.fileAnalysisError": "Lo siento, no pude procesar ese archivo.",
    "chatbot.contactAdded": "OK, he añadido a {name} a tus contactos.",
    "clientForm.addTitle": "Añadir Nuevo Cliente",
    "clientForm.editTitle": "Editar Cliente",
    "clientForm.companyName": "Nombre de la Empresa",
    "clientForm.phoneNumber": "Número de Teléfono",
    "clientForm.industry": "Rubro o Actividad",
    "clientForm.cancel": "Cancelar",
    "clientForm.save": "Guardar",
    "multiClientForm.title": "Añadir Múltiples Clientes",
    "multiClientForm.pasteLabel": "Pega una lista de clientes abajo. Cada cliente debe estar en una nueva línea. Puedes usar comas o tabulaciones para separar Nombre de Empresa, Teléfono e Industria.",
    "multiClientForm.pastePlaceholder": "Ejemplo:\nInnovate Inc, 555-123-4567, Tecnología\nBuildCo, 555-987-6543, Construcción\nSolo un número: 555-222-3333",
    "multiClientForm.preview": "Previsualizar",
    "multiClientForm.newClients": "Nuevos Clientes ({count})",
    "multiClientForm.noNewClients": "No hay nuevos clientes para añadir.",
    "multiClientForm.duplicates": "Números de Teléfono Duplicados ({count})",
    "multiClientForm.duplicatesQuestion": "Estos clientes ya existen. ¿Qué te gustaría hacer?",
    "multiClientForm.skip": "Omitir",
    "multiClientForm.overwrite": "Sobrescribir",
    "multiClientForm.noDuplicates": "No se encontraron duplicados.",
    "multiClientForm.back": "Atrás",
    "multiClientForm.confirmAndSave": "Confirmar y Guardar",
    "alerts.confirmDelete": "¿Estás seguro de que quieres eliminar este cliente?",
    "alerts.confirmFollowUpDelete": "¿Estás seguro de que quieres eliminar este seguimiento? Esta acción no se puede deshacer.",
    "alerts.importSuccess": "¡Importación completa! {added} clientes añadidos, {updated} clientes actualizados.",
    "alerts.noClientsParsed": "No se pudieron analizar datos de clientes válidos. Revisa el texto e inténtalo de nuevo.",
    "alerts.geminiAnalysisPrefix": "[Análisis de Gemini]:",
    "alerts.imageAnalysisFailed": "Error al analizar la imagen.",
    "alerts.onlyImagesAnalyzed": "Solo se pueden analizar archivos de imagen.",
    "alerts.fileUploadFailed": "Error al subir el archivo.",
    "alerts.unsupportedFileType": "Tipo de archivo no soportado. Sube archivos .xlsx, .xls, .csv o .txt.",
    "alerts.fileReadFailed": "Error al leer el archivo.",
    "alerts.noClientsInFile": "No se encontraron clientes válidos en el archivo.",
    "alerts.fileParseError": "Hubo un error al analizar el archivo. Revisa el formato e inténtalo de nuevo.",
    "settings.title": "Configuración",
    "settings.appearance": "Apariencia",
    "settings.light": "Claro",
    "settings.dark": "Oscuro",
    "settings.system": "Sistema",
    "settings.language": "Idioma",
    "settings.branding": "Marca",
    "settings.logo": "Logo de la Empresa",
    "settings.logoHelp": "Sube un logo para incluirlo en los PDFs generados.",
    "postponeModal.title": "Pospener Seguimiento",
    "rescheduleModal.title": "Reprogramar Seguimiento",
    "postponeModal.newDateTime": "Nueva fecha y hora",
    "postponeModal.reset": "Restablecer (7 días)",
    "notifications.followUp.title": "Recordatorio de Seguimiento",
    "notifications.followUp.body": "¡Es hora de hacer el seguimiento con {clientName}!",
    "countdown.paused": "Pausado",
    "suspended.title": "Suspendidos",
    "agenda.title": "Agenda",
    "addContact.manual": "Nuevo Contacto",
    "addContact.camera": "Cámara",
    "addContact.qr": "QR",
    "budgets.title": "Presupuestos",
    "budgets.lists": "Listas",
    "budgets.new": "Nuevo Presupuesto",
    "budgets.noClientSelected": "Selecciona un cliente para comenzar.",
    "budgets.selectClient": "Seleccionar un cliente...",
    "budgets.selectPriceList": "Seleccionar una lista de precios",
    "budgets.addProduct": "Añadir Producto",
    "budgets.finish": "Finalizar Presupuesto",
    "budgets.searchProduct": "Buscar producto por nombre o código...",
    "budgets.noProductsFound": "No se encontraron productos en esta lista.",
    "budgets.table.product": "Producto",
    "budgets.table.price": "Precio",
    "budgets.table.quantity": "Cant.",
    "budgets.table.total": "Total",
    "budgets.subtotal": "Subtotal",
    "budgets.discount": "Descuento",
    "budgets.total": "Total",
    "budgets.enterDiscount": "Ingresar descuento (%)",
    "budgets.confirm": "Confirmar",
    "budgets.saved": "¡Presupuesto guardado con éxito!",
    "budgets.preview": "Ver PDF",
    "budgets.share": "Compartir",
    "budgets.view": "Ver",
    "budgets.delete": "Eliminar",
    "budgets.noBudgets": "Aún no hay presupuestos creados para este cliente.",
    "budgets.searchOrAddClient": "Buscar cliente o escribir para añadir...",
    "budgets.addNewClient": "+ Agregar cliente: \"{name}\"",
    "budgets.noClientFound": "No se encontraron clientes.",
    "budgets.alert.selectClientAndProducts": "Por favor, selecciona o crea un cliente y añade al menos un producto.",
    "budgets.addClientModal.title": "Añadir Nuevo Cliente",
    "budgets.addClientModal.phoneRequired": "Se requiere un número de teléfono para añadir un cliente rápidamente.",
    "alerts.confirmBudgetDelete": "¿Estás seguro de que quieres eliminar este presupuesto?",
    "priceList.distributor": "Distribuidor",
    "priceList.consumer": "Cons. Final",
    "priceList.company": "Empresa",
    "priceList.cost": "Costo",
    "priceList.upload": "Sube o arrastra un archivo",
    "priceList.uploadFrom": "Subir desde",
    "priceList.device": "Dispositivo",
    "priceList.drive": "Drive",
    "priceList.uploadedOn": "Subido el",
    "priceList.view": "Ver",
    "priceList.replace": "Reemplazar",
    "priceList.delete": "Eliminar",
    "priceList.noList": "No hay lista cargada.",
    "priceList.processing": "Procesando archivo...",
    "priceList.parseError": "No se pudo procesar la lista. Revisa el formato.",
    "contextMenu.call": "Llamar a {phone}",
    "contextMenu.whatsapp": "Enviar WhatsApp",
    "contextMenu.whatsappCall": "Llamada de WhatsApp",
    "contextMenu.generateBudget": "Generar Presupuesto",
    "clientTypes.title": "Tipo de Cliente",
    "clientTypes.none": "Tipo"
  },
  pt: {
    "sidebar.title": "AGUAI",
    "sidebar.subtitle": "Gerencie seus contatos de forma eficiente.",
    "sidebar.addContact": "Adicionar Contato",
    "sidebar.addMultiple": "Multi",
    "sidebar.fromExcel": "Do Excel",
    "sidebar.fromDrive": "Do Drive",
    "sidebar.searchPlaceholder": "Buscar por nome ou telefone...",
    "clientDetail.noClientSelected": "Nenhum Cliente Selecionado",
    "clientDetail.selectOrAdd": "Selecione um cliente da lista ou adicione um novo.",
    "clientDetail.sendMessage": "Enviar Mensagem",
    "clientDetail.notOnWhatsApp": "Não está no WhatsApp",
    "clientDetail.checkingWhatsApp": "Verificando WhatsApp...",
    "clientDetail.followUpTitle": "Acompanhamento",
    "clientDetail.ratingTitle": "Avaliação do Cliente",
    "clientDetail.notesTitle": "Notas",
    "clientDetail.budgetsTitle": "Orçamentos / Cotações",
    "clientDetail.invoicesTitle": "Faturas",
    "followUp.nextFollowUp": "Tempo até o próximo acompanhamento:",
    "followUp.noFollowUp": "Nenhum acompanhamento agendado.",
    "followUp.due": "Acompanhamento necessário!",
    "followUp.registerCall": "Registrar Chamada",
    "followUp.postpone": "Adiar",
    "followUp.reschedule": "Reagendar",
    "followUp.pause": "Pausar",
    "followUp.resume": "Retomar",
    "followUp.delete": "Excluir",
    "notes.placeholder": "Escreva observações ou detalhes para futuras chamadas...",
    "notes.lastSaved": "Última gravação: {date}",
    "fileUpload.uploadNew": "Carregar Novo Arquivo",
    "fileUpload.descriptionPlaceholder": "Descrição opcional...",
    "fileUpload.selectFile": "Selecione um arquivo",
    "fileUpload.fileTypes": "PDF, PNG, JPG, etc.",
    "fileUpload.analyzeWithGemini": "Analisar com Gemini",
    "fileUpload.deleteFile": "Excluir arquivo",
    "chatbot.header": "Assistente AGUAI",
    "chatbot.inputPlaceholder": "Pergunte ou fale...",
    "chatbot.locationError": "Não consegui obter sua localização para responder. Verifique se os serviços de localização estão ativados.",
    "chatbot.sources": "Fontes:",
    "chatbot.speak": "Ativar Fala",
    "chatbot.stopSpeaking": "Desativar Fala",
    "chatbot.listening": "Ouvindo...",
    "chatbot.fileAnalysisError": "Desculpe, não consegui processar esse arquivo.",
    "chatbot.contactAdded": "OK, adicionei {name} aos seus contatos.",
    "clientForm.addTitle": "Adicionar Novo Cliente",
    "clientForm.editTitle": "Editar Cliente",
    "clientForm.companyName": "Nome da Empresa",
    "clientForm.phoneNumber": "Número de Telefone",
    "clientForm.industry": "Setor / Atividade",
    "clientForm.cancel": "Cancelar",
    "clientForm.save": "Salvar",
    "multiClientForm.title": "Adicionar Vários Clientes",
    "multiClientForm.pasteLabel": "Cole uma lista de clientes abaixo. Cada cliente deve estar em uma nova linha. Você pode usar vírgulas ou tabulações para separar Nome da Empresa, Telefone e Setor.",
    "multiClientForm.pastePlaceholder": "Exemplo:\nInnovate Inc, 555-123-4567, Tecnologia\nBuildCo, 555-987-6543, Construção\nSó um número: 555-222-3333",
    "multiClientForm.preview": "Visualizar",
    "multiClientForm.newClients": "Novos Clientes ({count})",
    "multiClientForm.noNewClients": "Nenhum novo cliente para adicionar.",
    "multiClientForm.duplicates": "Números de Telefone Duplicados ({count})",
    "multiClientForm.duplicatesQuestion": "Estes clientes já existem. O que você gostaria de fazer?",
    "multiClientForm.skip": "Pular",
    "multiClientForm.overwrite": "Sobrescrever",
    "multiClientForm.noDuplicates": "Nenhum duplicado encontrado.",
    "multiClientForm.back": "Voltar",
    "multiClientForm.confirmAndSave": "Confirmar e Salvar",
    "alerts.confirmDelete": "Tem certeza de que deseja excluir este cliente?",
    "alerts.confirmFollowUpDelete": "Tem certeza de que deseja excluir este acompanhamento? Esta ação não pode ser desfeita.",
    "alerts.importSuccess": "Importação concluída! {added} clientes adicionados, {updated} clientes atualizados.",
    "alerts.noClientsParsed": "Não foi possível analisar dados de clientes válidos. Verifique o texto e tente novamente.",
    "alerts.geminiAnalysisPrefix": "[Análise do Gemini]:",
    "alerts.imageAnalysisFailed": "Falha ao analisar a imagem.",
    "alerts.onlyImagesAnalyzed": "Apenas arquivos de imagem podem ser analisados.",
    "alerts.fileUploadFailed": "Falha ao carregar o arquivo.",
    "alerts.unsupportedFileType": "Tipo de arquivo não suportado. Carregue arquivos .xlsx, .xls, .csv ou .txt.",
    "alerts.fileReadFailed": "Falha ao ler o arquivo.",
    "alerts.noClientsInFile": "Nenhum cliente válido encontrado no arquivo.",
    "alerts.fileParseError": "Ocorreu um erro ao analisar o arquivo. Verifique o formato e tente novamente.",
    "settings.title": "Configurações",
    "settings.appearance": "Aparência",
    "settings.light": "Claro",
    "settings.dark": "Escuro",
    "settings.system": "Sistema",
    "settings.language": "Idioma",
    "postponeModal.title": "Adiar Acompanhamento",
    "rescheduleModal.title": "Reagendar Acompanhamento",
    "postponeModal.newDateTime": "Nova data e hora",
    "postponeModal.reset": "Redefinir (7 dias)",
    "notifications.followUp.title": "Lembrete de Acompanhamento",
    "notifications.followUp.body": "Hora de fazer o acompanhamento com {clientName}!",
    "countdown.paused": "Pausado",
    "suspended.title": "Suspensos",
    "agenda.title": "Agenda",
    "addContact.manual": "Manual",
    "addContact.camera": "Escanear Cartão",
    "addContact.qr": "Escanear QR",
    "budgets.title": "Orçamentos",
    "budgets.lists": "Listas",
    "budgets.new": "Novo Orçamento",
    "budgets.selectClient": "Selecionar ou Adicionar Cliente",
    "budgets.searchOrAddClient": "Buscar cliente ou digitar para adicionar...",
    "budgets.addNewClient": "+ Adicionar novo cliente: \"{name}\"",
    "budgets.noClientFound": "Nenhum cliente encontrado.",
    "budgets.alert.selectClientAndProducts": "Por favor, selecione ou crie um cliente e adicione pelo menos um produto.",
    "budgets.addClientModal.title": "Adicionar Novo Cliente",
    "budgets.addClientModal.phoneRequired": "Um número de telefone é necessário para adicionar um cliente rapidamente.",
    "contextMenu.call": "Ligar para {phone}",
    "contextMenu.whatsapp": "Enviar WhatsApp",
    "contextMenu.whatsappCall": "Chamada de WhatsApp",
    "contextMenu.generateBudget": "Gerar Orçamento",
    "clientTypes.title": "Tipo de Cliente",
    "clientTypes.none": "Tipo"
  },
  it: {
    "sidebar.title": "AGUAI",
    "sidebar.subtitle": "Gestisci i tuoi contatti in modo efficiente.",
    "sidebar.addContact": "Aggiungi Contatto",
    "sidebar.addMultiple": "Multi",
    "sidebar.fromExcel": "Da Excel",
    "sidebar.fromDrive": "Da Drive",
    "sidebar.searchPlaceholder": "Cerca per nome o telefono...",
    "clientDetail.noClientSelected": "Nessun Cliente Selezionato",
    "clientDetail.selectOrAdd": "Seleziona un cliente dall'elenco o aggiungine uno nuovo.",
    "clientDetail.sendMessage": "Invia Messaggio",
    "clientDetail.notOnWhatsApp": "Non è su WhatsApp",
    "clientDetail.checkingWhatsApp": "Verifica WhatsApp in corso...",
    "clientDetail.followUpTitle": "Follow-up",
    "clientDetail.ratingTitle": "Valutazione Cliente",
    "clientDetail.notesTitle": "Note",
    "clientDetail.budgetsTitle": "Preventivi / Offerte",
    "clientDetail.invoicesTitle": "Fatture",
    "followUp.nextFollowUp": "Tempo fino al prossimo follow-up:",
    "followUp.noFollowUp": "Nessun follow-up programmato.",
    "followUp.due": "Follow-up necessario!",
    "followUp.registerCall": "Registra Chiamata",
    "followUp.postpone": "Posticipa",
    "followUp.reschedule": "Ripianifica",
    "followUp.pause": "Pausa",
    "followUp.resume": "Riprendi",
    "followUp.delete": "Elimina",
    "notes.placeholder": "Scrivi osservazioni o dettagli per chiamate future...",
    "notes.lastSaved": "Ultimo salvataggio: {date}",
    "fileUpload.uploadNew": "Carica Nuovo File",
    "fileUpload.descriptionPlaceholder": "Descrizione opzionale...",
    "fileUpload.selectFile": "Seleziona un file",
    "fileUpload.fileTypes": "PDF, PNG, JPG, ecc.",
    "fileUpload.analyzeWithGemini": "Analizza con Gemini",
    "fileUpload.deleteFile": "Elimina file",
    "chatbot.header": "Assistente AGUAI",
    "chatbot.inputPlaceholder": "Chiedi o parla...",
    "chatbot.locationError": "Non sono riuscito a ottenere la tua posizione per rispondere. Assicurati di aver abilitato i servizi di localizzazione.",
    "chatbot.sources": "Fonti:",
    "chatbot.speak": "Abilita Voce",
    "chatbot.stopSpeaking": "Disabilita Voce",
    "chatbot.listening": "In ascolto...",
    "chatbot.fileAnalysisError": "Spiacente, non sono riuscito a elaborare quel file.",
    "chatbot.contactAdded": "OK, ho aggiunto {name} ai tuoi contatti.",
    "clientForm.addTitle": "Aggiungi Nuovo Cliente",
    "clientForm.editTitle": "Modifica Cliente",
    "clientForm.companyName": "Nome Azienda",
    "clientForm.phoneNumber": "Numero di Telefono",
    "clientForm.industry": "Settore / Attività",
    "clientForm.cancel": "Annulla",
    "clientForm.save": "Salva",
    "multiClientForm.title": "Aggiungi Clienti Multipli",
    "multiClientForm.pasteLabel": "Incolla un elenco di clienti qui sotto. Ogni cliente deve essere su una nuova riga. Puoi usare virgole o tabulazioni per separare Nome Azienda, Telefono e Settore.",
    "multiClientForm.pastePlaceholder": "Esempio:\nInnovate Inc, 555-123-4567, Tecnologia\nBuildCo, 555-987-6543, Edilizia\nSolo un numero: 555-222-3333",
    "multiClientForm.preview": "Anteprima",
    "multiClientForm.newClients": "Nuovi Clienti ({count})",
    "multiClientForm.noNewClients": "Nessun nuovo cliente da aggiungere.",
    "multiClientForm.duplicates": "Numeri di Telefono Duplicati ({count})",
    "multiClientForm.duplicatesQuestion": "Questi clienti esistono già. Cosa vorresti fare?",
    "multiClientForm.skip": "Salta",
    "multiClientForm.overwrite": "Sovrascrivi",
    "multiClientForm.noDuplicates": "Nessun duplicato trovato.",
    "multiClientForm.back": "Indietro",
    "multiClientForm.confirmAndSave": "Conferma e Salva",
    "alerts.confirmDelete": "Sei sicuro di voler eliminare questo cliente?",
    "alerts.confirmFollowUpDelete": "Sei sicuro di voler eliminare questo follow-up? L'azione non può essere annullata.",
    "alerts.importSuccess": "Importazione completata! {added} clienti aggiunti, {updated} clienti aggiornati.",
    "alerts.noClientsParsed": "Nessun dato cliente valido è stato analizzato. Controlla il testo e riprova.",
    "alerts.geminiAnalysisPrefix": "[Analisi di Gemini]:",
    "alerts.imageAnalysisFailed": "Analisi dell'immagine non riuscita.",
    "alerts.onlyImagesAnalyzed": "È possibile analizzare solo file di immagine.",
    "alerts.fileUploadFailed": "Caricamento del file non riuscito.",
    "alerts.unsupportedFileType": "Tipo di file non supportato. Carica file .xlsx, .xls, .csv o .txt.",
    "alerts.fileReadFailed": "Lettura del file non riuscita.",
    "alerts.noClientsInFile": "Nessun cliente valido trovato nel file.",
    "alerts.fileParseError": "Si è verificato un errore durante l'analisi del file. Controlla il formato e riprova.",
    "settings.title": "Impostazioni",
    "settings.appearance": "Aspetto",
    "settings.light": "Chiaro",
    "settings.dark": "Scuro",
    "settings.system": "Sistema",
    "settings.language": "Lingua",
    "postponeModal.title": "Posticipa Follow-up",
    "rescheduleModal.title": "Ripianifica Follow-up",
    "postponeModal.newDateTime": "Nuova data e ora",
    "postponeModal.reset": "Ripristina (7 giorni)",
    "notifications.followUp.title": "Promemoria Follow-up",
    "notifications.followUp.body": "È ora di fare il follow-up con {clientName}!",
    "countdown.paused": "In pausa",
    "suspended.title": "Sospesi",
    "agenda.title": "Agenda",
    "addContact.manual": "Manuale",
    "addContact.camera": "Scansiona Biglietto",
    "addContact.qr": "Scansiona QR",
    "budgets.title": "Preventivi",
    "budgets.lists": "Elenchi",
    "budgets.new": "Nuovo Preventivo",
    "budgets.selectClient": "Seleziona o Aggiungi Cliente",
    "budgets.searchOrAddClient": "Cerca cliente o digita per aggiungere...",
    "budgets.addNewClient": "+ Aggiungi nuovo cliente: \"{name}\"",
    "budgets.noClientFound": "Nessun cliente trovato.",
    "budgets.alert.selectClientAndProducts": "Seleziona o crea un cliente e aggiungi almeno un prodotto.",
    "budgets.addClientModal.title": "Aggiungi Nuovo Cliente",
    "budgets.addClientModal.phoneRequired": "È richiesto un numero di telefono per aggiungere rapidamente un cliente.",
    "contextMenu.call": "Chiama {phone}",
    "contextMenu.whatsapp": "Invia WhatsApp",
    "contextMenu.whatsappCall": "Chiamata WhatsApp",
    "contextMenu.generateBudget": "Genera Preventivo",
    "clientTypes.title": "Tipo Cliente",
    "clientTypes.none": "Tipo"
  },
  de: {
    "sidebar.title": "AGUAI",
    "sidebar.subtitle": "Verwalten Sie Ihre Kontakte effizient.",
    "sidebar.addContact": "Kontakt hinzufügen",
    "sidebar.addMultiple": "Multi",
    "sidebar.fromExcel": "Aus Excel",
    "sidebar.fromDrive": "Aus Drive",
    "sidebar.searchPlaceholder": "Suche nach Name oder Telefon...",
    "clientDetail.noClientSelected": "Kein Kunde ausgewählt",
    "clientDetail.selectOrAdd": "Wählen Sie einen Kunden aus der Liste oder fügen Sie einen neuen hinzu.",
    "clientDetail.sendMessage": "Nachricht senden",
    "clientDetail.notOnWhatsApp": "Nicht bei WhatsApp",
    "clientDetail.checkingWhatsApp": "WhatsApp wird geprüft...",
    "clientDetail.followUpTitle": "Follow-up",
    "clientDetail.ratingTitle": "Kundenbewertung",
    "clientDetail.notesTitle": "Notizen",
    "clientDetail.budgetsTitle": "Angebote / Kostenvoranschläge",
    "clientDetail.invoicesTitle": "Rechnungen",
    "followUp.nextFollowUp": "Zeit bis zum nächsten Follow-up:",
    "followUp.noFollowUp": "Kein Follow-up geplant.",
    "followUp.due": "Follow-up fällig!",
    "followUp.registerCall": "Anruf registrieren",
    "followUp.postpone": "Verschieben",
    "followUp.reschedule": "Neu planen",
    "followUp.pause": "Pausieren",
    "followUp.resume": "Fortsetzen",
    "followUp.delete": "Löschen",
    "notes.placeholder": "Schreiben Sie Beobachtungen oder Details für zukünftige Anrufe...",
    "notes.lastSaved": "Zuletzt gespeichert: {date}",
    "fileUpload.uploadNew": "Neue Datei hochladen",
    "fileUpload.descriptionPlaceholder": "Optionale Beschreibung...",
    "fileUpload.selectFile": "Datei auswählen",
    "fileUpload.fileTypes": "PDF, PNG, JPG, etc.",
    "fileUpload.analyzeWithGemini": "Mit Gemini analysieren",
    "fileUpload.deleteFile": "Datei löschen",
    "chatbot.header": "AGUAI Assistent",
    "chatbot.inputPlaceholder": "Fragen oder sprechen Sie...",
    "chatbot.locationError": "Ich konnte Ihren Standort nicht abrufen, um das zu beantworten. Bitte stellen Sie sicher, dass die Ortungsdienste aktiviert sind.",
    "chatbot.sources": "Quellen:",
    "chatbot.speak": "Sprache aktivieren",
    "chatbot.stopSpeaking": "Sprache deaktivieren",
    "chatbot.listening": "Höre zu...",
    "chatbot.fileAnalysisError": "Entschuldigung, ich konnte diese Datei nicht verarbeiten.",
    "chatbot.contactAdded": "OK, ich habe {name} zu Ihren Kontakten hinzugefügt.",
    "clientForm.addTitle": "Neuen Kunden hinzufügen",
    "clientForm.editTitle": "Kunden bearbeiten",
    "clientForm.companyName": "Firmenname",
    "clientForm.phoneNumber": "Telefonnummer",
    "clientForm.industry": "Branche / Tätigkeit",
    "clientForm.cancel": "Abbrechen",
    "clientForm.save": "Speichern",
    "multiClientForm.title": "Mehrere Kunden hinzufügen",
    "multiClientForm.pasteLabel": "Fügen Sie unten eine Liste von Kunden ein. Jeder Kunde sollte in einer neuen Zeile stehen. Sie können Kommas oder Tabulatoren verwenden, um Firmenname, Telefonnummer und Branche zu trennen.",
    "multiClientForm.pastePlaceholder": "Beispiel:\nInnovate Inc, 555-123-4567, Technologie\nBuildCo, 555-987-6543, Bauwesen\nNur eine Nummer: 555-222-3333",
    "multiClientForm.preview": "Vorschau",
    "multiClientForm.newClients": "Neue Kunden ({count})",
    "multiClientForm.noNewClients": "Keine neuen Kunden zum Hinzufügen.",
    "multiClientForm.duplicates": "Doppelte Telefonnummern ({count})",
    "multiClientForm.duplicatesQuestion": "Diese Kunden existieren bereits. Was möchten Sie tun?",
    "multiClientForm.skip": "Überspringen",
    "multiClientForm.overwrite": "Überschreiben",
    "multiClientForm.noDuplicates": "Keine Duplikate gefunden.",
    "multiClientForm.back": "Zurück",
    "multiClientForm.confirmAndSave": "Bestätigen und Speichern",
    "alerts.confirmDelete": "Sind Sie sicher, dass Sie diesen Kunden löschen möchten?",
    "alerts.confirmFollowUpDelete": "Sind Sie sicher, dass Sie dieses Follow-up löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.",
    "alerts.importSuccess": "Import abgeschlossen! {added} Kunden hinzugefügt, {updated} Kunden aktualisiert.",
    "alerts.noClientsParsed": "Es konnten keine gültigen Kundendaten analysiert werden. Bitte überprüfen Sie Ihren Text und versuchen Sie es erneut.",
    "alerts.geminiAnalysisPrefix": "[Gemini-Analyse]:",
    "alerts.imageAnalysisFailed": "Bildanalyse fehlgeschlagen.",
    "alerts.onlyImagesAnalyzed": "Nur Bilddateien können analysiert werden.",
    "alerts.fileUploadFailed": "Hochladen der Datei fehlgeschlagen.",
    "alerts.unsupportedFileType": "Nicht unterstützter Dateityp. Bitte laden Sie .xlsx-, .xls-, .csv- oder .txt-Dateien hoch.",
    "alerts.fileReadFailed": "Lesen der Datei fehlgeschlagen.",
    "alerts.noClientsInFile": "Keine gültigen Kunden in der Datei gefunden.",
    "alerts.fileParseError": "Beim Analysieren der Datei ist ein Fehler aufgetreten. Bitte überprüfen Sie das Dateiformat und versuchen Sie es erneut.",
    "settings.title": "Einstellungen",
    "settings.appearance": "Erscheinungsbild",
    "settings.light": "Hell",
    "settings.dark": "Dunkel",
    "settings.system": "System",
    "settings.language": "Sprache",
    "postponeModal.title": "Follow-up verschieben",
    "rescheduleModal.title": "Follow-up neu planen",
    "postponeModal.newDateTime": "Neues Datum und neue Uhrzeit",
    "postponeModal.reset": "Zurücksetzen (7 Tage)",
    "notifications.followUp.title": "Follow-up-Erinnerung",
    "notifications.followUp.body": "Zeit für das Follow-up mit {clientName}!",
    "countdown.paused": "Pausiert",
    "suspended.title": "Ausgesetzt",
    "agenda.title": "Agenda",
    "addContact.manual": "Manuell",
    "addContact.camera": "Karte scannen",
    "addContact.qr": "QR scannen",
    "budgets.title": "Angebote",
    "budgets.lists": "Listen",
    "budgets.new": "Neues Angebot",
    "budgets.selectClient": "Kunde auswählen oder hinzufügen",
    "budgets.searchOrAddClient": "Kunde suchen oder zum Hinzufügen tippen...",
    "budgets.addNewClient": "+ Neuen Kunden hinzufügen: \"{name}\"",
    "budgets.noClientFound": "Kein Kunde gefunden.",
    "budgets.alert.selectClientAndProducts": "Bitte wählen oder erstellen Sie einen Kunden und fügen Sie mindestens ein Produkt hinzu.",
    "budgets.addClientModal.title": "Neuen Kunden hinzufügen",
    "budgets.addClientModal.phoneRequired": "Eine Telefonnummer ist erforderlich, um schnell einen Kunden hinzuzufügen.",
    "contextMenu.call": "Anrufen {phone}",
    "contextMenu.whatsapp": "WhatsApp senden",
    "contextMenu.whatsappCall": "WhatsApp-Anruf",
    "contextMenu.generateBudget": "Angebot erstellen",
    "clientTypes.title": "Kundentyp",
    "clientTypes.none": "Typ"
  }
};

interface LanguageContextType {
  language: Language;
  setLanguage: (language: Language) => void;
  t: (key: string, replacements?: Record<string, string | number>) => string;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

const getNavigatorLanguage = (): Language => {
    if (typeof navigator === 'undefined') return 'en';
    const lang = navigator.language.split('-')[0];
    if (Object.keys(translations).includes(lang)) {
        return lang as Language;
    }
    return 'en';
};

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguageState] = useState<Language>(() => {
    if (typeof window !== 'undefined') {
      const savedLang = localStorage.getItem('language');
      if (savedLang && Object.keys(translations).includes(savedLang)) {
        return savedLang as Language;
      }
    }
    return getNavigatorLanguage();
  });

  useEffect(() => {
    localStorage.setItem('language', language);
  }, [language]);

  const setLanguage = (newLanguage: Language) => {
    setLanguageState(newLanguage);
  };

  const t = useCallback((key: string, replacements?: Record<string, string | number>): string => {
    const translation = translations[language][key] || translations['en'][key] || key;
    if (!replacements) {
        return translation;
    }
    return Object.entries(replacements).reduce((acc, [placeholder, value]) => {
        return acc.replace(`{${placeholder}}`, String(value));
    }, translation);
  }, [language]);

  const value = useMemo(() => ({ language, setLanguage, t }), [language, t]);

  return React.createElement(LanguageContext.Provider, { value }, children);
};

export const useTranslation = (): LanguageContextType => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
};